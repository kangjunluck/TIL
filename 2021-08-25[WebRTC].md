# 2021-08-25

# [WebRTC]

> 웹 브라우저 간에 플러그인의 도움 없이 서로 통신할 수 있도록 설계된 API

**정리 : WebRTC의 실시간 데이터 교환은 '시그널링이라 일컫어지는 NAT 우회 과정을 거치기 때문이다'**

#### vs WebSocket

: 브라우저 - 브라우저 간 통신을 한다. websocket은 브라우저-서버 간 양방향 통신을 구현한다.

### WebRTC 연결 단계

- 브라우저 간 P2P 정보교환에 동의해야한다
- 서로의 주소를 알아야 한다
- 보안 사항 및 방화벽 우회
- 멀티미디어 데이터를 실시간으로 교환

### NAT 트래버셜

**사실**

- 컴퓨터마다 공인 IP가 할당되어 있지 않다
  - 방화벽 때문에
  - 공인 IP를 라우터로 NAT하여 사설 IP를 매핑시킨다.
  - 결국 사설 IP를 알아야 한다!!
- 라우터를 통과해 연결 방법을 찾는 것 = NAT 트래버셜

### STUN, TURN 서버

- ICE 프레임워크를 통해 각 서버를 이용해 IP를 알아내게 된다.(후보만)

- STUN 서버를 통해 NAT 트래버셜 작업이 이루어 진다.
- 공인 IP와 포트를 알려준다
- 문제
  - 방화벽
  - 이전 연결 네트워크만 연결 가능(Symmetric NAT)
- **TURN 서버**가 해결
  - 완전한 P2P는 아니다 > 지연이 발생한다



### Kurento Media Server

#### WebRTC는 직접 브라우저간 연결이지만, 아직 초기 기술이며, 코덱 문제/복잡한 서비스에 부족하다

중앙 미디어 서버를 통해 보안해준다

중앙 미디어 서버 특징

1. 그룹 통신: 한 피어가 생성하는 미디어 스트림을 여러 수신기 사이에 배포하는 것, 즉 다중 회의 장치("MCU") 역할을 합니다.
2. 혼합: 여러 수신 스트림을 하나의 단일 복합 스트림으로 변환합니다.
3. 트랜스코딩: 호환되지 않는 클라이언트 간에 코덱 및 형식을 즉시 적용합니다.
4. 녹음: 피어 간에 교환되는 미디어를 지속적으로 저장합니다.



#### Openvidu

> 파이프라인 생성 수정 삭제, stun/turn 서버 경유 등의 구현을 kurento media 서버 및 openvidu 서버로 이미 구축해두고 client 부분에 대한 구현만을 통해 화상 기능을 적용하도록 한 플랫폼

- 무엇이 다른가?

  복잡한 WebRTC 통신 일부를 삭제하여 더 간단하게 WebRTC를 구현한 것으로, 클라이언트 측만으로 구현이 가능하다

  기존 Coturn을 통해 STUN/TURN 서버를 형성했던 것과 다르게 이것조차 구현하지 않는다

- 어떻게?

  Openvidu server에서 session에 참가,퇴장할때마다 하나의 turnadmin(coturn이 제공하는 것으로 이것을 바탕으로 인증된다)가 만들어진다. 

  즉 openvidu server 내에 coturn turn서버를 고정시켜두었다.
